{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'common.css' %}"> 
    <script src="{% static 'common.js' %}"></script>
</head>
<body id="body"> 
<div id='navbar'>
    <div id='searchbar'>
        <form method="get" action="{% url 'storefront:search' %}">
            <input type='text' name='query' class="searchbarsizing" value=""{{ query }} placeholder='Search'>
            <button hidden>Search</button>
        </form>
    </div>
    <div id="category-filter">
        <form method="get" action="{% url 'home' %}">
            <select name="category" onchange="this.form.submit()">
                <option value="">All Categories</option>
                {% for category in global_categories %}
                    <option value="{{ category.id }}"
                        {% if global_selected_category and global_selected_category.id == category.id %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>

    <a class='browsing-button' href="{% url 'product:productbrowsing' %}"><button class="browsebtn">Browse</button></a>

    {% if request.user.is_authenticated %}
        <div class='authenticated-nav-links'>
            <a href="{% url 'product:newproduct' %}"><button class="addbtn">List Item</button></a>
            <a href="{% url 'dashboard:UserHome' %}"><button class="createbtn">Item Listing</button></a>
            <a href="{% url 'cart:Home' %}"><button class="cartbtn">Cart</button></a>
            <a href="{% url 'storefront:logout' %}"><button class="logoutbtn">Logout</button></a>
        </div>

    {% else %}
        <div class='navigation-buttons'>
            <a class='login-button' href="{% url 'storefront:login' %}"><button class="logbtn">Login</button></a>
            <a class='singup-button' href="{% url 'storefront:signup' %}"><button class="signbtn">Sign Up</button></a>
        </div>
    {% endif %}
    <form id="openai-form">
        <label for="prompt-input">Enter your prompt:</label><br>
        <textarea id="prompt-input" rows="5" cols="50"></textarea><br>
        <button type="submit">Generate Response</button>
    </form>
    <div id="openai-response"></div> 
    <script>
        document.getElementById('openai-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const prompt = document.getElementById('prompt-input').value;
            const responseDiv = document.getElementById('openai-response');
            responseDiv.innerHTML = 'Generating...';

            try {
                const formData = new FormData();
                formData.append('prompt', prompt);

                const response = await fetch('/openai-api/', { // Adjust URL if needed
                    method: 'POST',
                    body: formData,
                    // If you're using proper CSRF protection in Django,
                    // you'll need to include the CSRF token here.
                    // headers: { 'X-CSRFToken': getCookie('csrftoken') }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.response) {
                    responseDiv.innerHTML = data.response;
                } else if (data.error) {
                    responseDiv.innerHTML = `Error: ${data.error}`;
                }
            } catch (error) {
                console.error('Fetch error:', error);
                responseDiv.innerHTML = `An error occurred: ${error.message}`;
            }
        });
        
        // for csrf varification later
        /*
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                    }
                }
            }
            return cookieValue;
        }
        */
    </script>
    <div id='options'>
        <button class='options-button'>Information</button>
        <div id='options-dropdown'>
            <ul id='options-list'>
                <li class='options-list-e'>
                    <button>Legal Matters</button>
                    <div class='extra-contents'>
                        <p class="footertxt">Privacy Policy</p>
                        <p class="footertxt">Terms of Service</p>
                        <p class="footertxt">Cookie Settings</p>
                        <p class="footertxt">Return/Refund Policies</p>
                    </div>
                </li>
                <li class='options-list-e'>
                    <button>Contact</button>
                    <div class='extra-contents'>
                        <p class="footertxt">Phone Number: 662-327-459</p>
                        <p class="footertxt">Email: fakestop@gmail.com</p>
                        <p class="footertxt">Address: Water Valley, MS</p>
                    </div>
                </li>
                <li class='options-list-e'>
                    <button>Navigation Links</button>
                    <div class='extra-contents'>
                        <p class="footertxt">About Us</p>
                        <p class="footertxt">FAQ</p>
                        <p class="footertxt">Customer Service</p>
                    </div>
                </li>
            </ul>
        </div>
    </div> 
</div>
    {% block content %} {% endblock content %}
</body>
</html>